/* Webpack & Concatenate browser pack tool
 * Source Path:resource-app\lib\sdk.js
 * Target: node */
/*! For license information please see d709l69syom.js.LICENSE.txt */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(global,(function(){return e={299:function(e){function t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function r(e){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?t(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(){"use strict";a=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},s=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",c=n.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function p(e,t,r,n){var o=t&&t.prototype instanceof f?t:f,a=Object.create(o.prototype),s=new k(n||[]);return a._invoke=function(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return{value:void 0,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var i=x(s,r);if(i){if(i===d)continue;return i}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=l(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===d)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,s),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=p;var d={};function f(){}function h(){}function w(){}var v={};u(v,s,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(S([])));m&&m!==t&&r.call(m,s)&&(v=m);var y=w.prototype=f.prototype=Object.create(v);function b(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function n(a,s,i,c){var u=l(e[a],e,s);if("throw"!==u.type){var p=u.arg,d=p.value;return d&&"object"==o(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,i,c)}),(function(e){n("throw",e,i,c)})):t.resolve(d).then((function(e){p.value=e,i(p)}),(function(e){return n("throw",e,i,c)}))}c(u.arg)}var a;this._invoke=function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return a=a?a.then(o,o):o()}}function x(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var n=l(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,d;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function S(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:E}}function E(){return{value:void 0,done:!0}}return h.prototype=w,u(y,"constructor",w),u(w,"constructor",h),h.displayName=u(w,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,u(e,c,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(_.prototype),u(_.prototype,i,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var s=new _(p(t,r,n,o),a);return e.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),u(y,c,"Generator"),u(y,s,(function(){return this})),u(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=S,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return s.type="throw",s.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var i=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(i&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(i){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),A(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:S(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function s(e,t,r,n,o,a,s){try{var i=e[a](s),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(n,o)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){s(a,n,o,i,c,"next",e)}function c(e){s(a,n,o,i,c,"throw",e)}i(void 0)}))}}var c="browser";function u(e){return new Promise((function(t,r){var n="/vm/";e&&e(n),t(n)}))}var p={},l=function(){function e(){return e=i(a().mark((function e(r,o){var s,i,u,p,l,d;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=t(r=n(r),o)).request.headers=r.request.headers||{},e.next=5,fetch(r.request.url,{headers:r.request.headers||{"x-platform":navigator.platform.toLowerCase()},method:r.request.method||"GET",body:r.request.body?"JSON"==r.request.body.encode?JSON.stringify(r.request.body.data):r.request.body.data.toString():void 0});case 5:return s=e.sent,e.t0=s.status,e.t1=s.headers,e.next=10,s.text();case 10:if(e.t2=e.sent,502==(i={status:e.t0,headers:e.t1,response:e.t2}).status&&((u=new c("common.js")).info("http 502 error"),"webapi-concatenate.deta.dev"==new URL(r.request.url).hostname&&(u.info("api feedback"),p={method:"POST",body:JSON.stringify({level:"error",type:"server",data:{url:r.request.url,headers:r.request.headers,method:r.request.method,body:r.request.body?"JSON"==r.request.body.encode?JSON.stringify(r.request.body.data):r.request.body.data.toString():void 0}})},u.info(p),fetch("https://log-concatenate.deta.dev/",p))),i.status!=r.response.success&&"all"!=r.response.success){e.next=20;break}if(l={},"all"==r.response.data)l=i.response;else for(d in"string"==typeof r.response.data&&(r.response.data=JSON.parse(r.response.data)),s=JSON.parse(i.response),r.response.data)l[d]=s[r.response.data[d]];return e.abrupt("return",["success",l,i.status,i.headers]);case 20:return e.abrupt("return",["failure",i.response,i.status,i.headers]);case 21:case 22:case"end":return e.stop()}}),e)}))),e.apply(this,arguments)}function t(e,n){for(var a in e)"object"==o(e[a])?e[a]=t(e[a],n):"string"==typeof e[a]&&(e[a]=r(e[a],n));return e}function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"!=typeof e)return e;var r=e.match(/\${.*?}/gim);if(null==r)return e;for(var n=0;n<r.length;n++)e=e.replace(r[n],t[r[n].substring(2,r[n].length-1)]||r[n]);return e}function n(e){if("object"!==o(e))return e;var t={};for(var r in e)e[r]instanceof Object?t[r]=n(e[r]):t[r]=e[r];return t}function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.array=new Array(e.length);for(var t=0,r=e.length;t<r;++t)this.array[t]=e[t]}function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";this.env=e,this.level=c.INFO}return s.prototype.append=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var n=0,o=t.length;n<o;++n)if(t[n]instanceof s)for(var a=0,i=t[n].length;a<i;++a)this.array.push(t[n].array[a]);else if("string"==typeof t[n])for(a=0,i=t[n].length;a<i;++a)this.array.push(t[n][a]);else this.array.push(t[n].toString())},s.prototype.toString=function(){return this.array.join("")},s.prototype.clear=function(){this.array.length=0},c.ALL=0,c.TRACE=1,c.DEBUG=2,c.INFO=3,c.WARN=4,c.ERROR=5,c.FATAL=6,c.MARK=7,c.OFF=8,c.level_color=[0,"grey","cyan","green","yellow","red","magenta","grey","grey"],c.level_name=["ALL","TRACE","DEBUG","INFO","WARN","ERROR","FATAL","MARK","OFF"],c.prototype.filter=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.INFO;this.level=e},c.prototype.print=function(e,t){if(e<this.level)return-1;var r=new s;return this.print_to_console(r,e,t)},c.prototype.print_to_console=function(e,t,r){e.append("%c [",(new Date).toISOString(),"] [",c.level_name[t],"] ",this.env," - ","%c ");for(var n=0,a=r.length;n<a;++n)e.append(r[n]instanceof Error?r[n].message+"\n"+r[n].stack:r[n]instanceof Function?r[n].name:"object"===o(r[n])?JSON.stringify(r[n]):void 0===r[n]?"undefined":r[n].toString()," ");return console.log(e.toString(),"color: "+c.level_color[t],"color: black"),0},c.prototype.trace=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.print(c.TRACE,t)},c.prototype.debug=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.print(c.DEBUG,t)},c.prototype.info=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.print(c.INFO,t)},c.prototype.warn=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.print(c.WARN,t)},c.prototype.error=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.print(c.ERROR,t)},c.prototype.fatal=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.print(c.FATAL,t)},c.prototype.mark=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.print(c.MARK,t)},c.prototype.off=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.print(c.OFF,t)},{makeRequest:function(t,r){return e.apply(this,arguments)},fetch:fetch,replaceString:r,replaceObjects:t,convertResponse:function(e){return"success"==e[0]?JSON.stringify({status:"success",data:e[1]}):JSON.stringify({status:e[0],data:{source_return:e[1]},code:e[2]})},sqlInjectionTest:function(e){return!!e.match(/create\s|drop\s|table\s|primary\s|key\s|insert\s|into\s|values\s|select\s|and\s|between\s|exists\s|in\s|like\s|glob\s|not\s|or\s|is\s|null\s|not\s|unique\s|where\s|update\s|limit\s|order\s|group\s|having\s|distinct\s|pragma\s|\s by|and'|or'|and\d|or\d|\sfrom|from\s|\swhere/gim)},deeply_copy:n,StringBuilder:s,logger:c,store:{set:function(e,t){localStorage[e]=t},get:function(e){return localStorage[e]},delete:function(e){localStorage.removeItem(e)}}}}(),d=new l.logger("SDK event bus");function f(e,t){p[e]||(p[e]=[]),p[e].length>20?d.error("too much listeners on event",e):p[e].push(t)}function h(e,t){if(p[e])for(var r=0,n=p[e].length;r<n;++r)p[e][r]==t&&p[e].splice(r,1)}var w,v,g,m,y={read:(v=i(a().mark((function e(t,r,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=i(a().mark((function e(r,o){var s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,localforage.getItem("file-"+t);case 3:s=e.sent,e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",o("File is not exists or it is not readable."));case 9:if(null!==s){e.next=12;break}return e.abrupt("return",o("File is not exists or it is not readable."));case 12:n&&n(s),r(s);case 14:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,r){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return v.apply(this,arguments)}),write:(w=i(a().mark((function e(t,r,n,o){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=i(a().mark((function e(r,s){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,localforage.setItem("file-"+t,n);case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return",s("File is not writable."));case 8:o&&o(),r();case 11:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t,r){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)}))),function(e,t,r,n){return w.apply(this,arguments)}),exists:function(e,t){return new Promise(function(){var r=i(a().mark((function r(n,o){return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,y.read(e);case 3:r.next=10;break;case 5:return r.prev=5,r.t0=r.catch(0),t&&t(!1),n(!1),r.abrupt("return");case 10:return t&&t(!0),n(!0),r.abrupt("return");case 14:case"end":return r.stop()}}),r,null,[[0,5]])})));return function(e,t){return r.apply(this,arguments)}}())},unlink:function(e,t){return new Promise(function(){var r=i(a().mark((function r(n,o){return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,localforage.removeItem(e);case 3:r.next=10;break;case 5:return r.prev=5,r.t0=r.catch(0),t&&t(!1),n(!1),r.abrupt("return");case 10:return t&&t(!0),n(!0),r.abrupt("return");case 14:case"end":return r.stop()}}),r,null,[[0,5]])})));return function(e,t){return r.apply(this,arguments)}}())}},b=new Map,_={do:(g=i(a().mark((function e(t){var r,n,o,s,c,p,l,d=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=d.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=d[o];if(s=6e5,!b.has("remote."+t)){e.next=11;break}if(c=b.get("remote."+t),!((new Date).getTime()-c.time>s)){e.next=7;break}return b.delete("remote."+t),e.abrupt("return",_.do.apply(_,[t].concat(n)));case 7:return e.abrupt("return",new Promise(function(){var e=i(a().mark((function e(t,r){var o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.func.apply(c,n);case 3:o=e.sent,e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(0),t({status:"error",json:function(){throw e.t0},text:function(){return e.t0.toString()}}),e.abrupt("return");case 10:t({status:"ok",json:function(){return JSON.parse(o)},text:function(){return o}});case 12:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,r){return e.apply(this,arguments)}}()));case 11:return e.next=13,u();case 13:p=e.sent;try{l=fRequire(p+"FaaS/remote/"+t+".js")}catch(e){}return b.set("remote."+t,{time:(new Date).getTime(),func:l}),e.abrupt("return",_.do.apply(_,[t].concat(n)));case 18:case 19:case"end":return e.stop()}}),e)}))),function(e){return g.apply(this,arguments)})},x={do:(m=i(a().mark((function e(t){var r,n,o,s,c,p,l,d=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=d.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=d[o];if(s=6e5,!b.has("local."+t)){e.next=11;break}if(c=b.get("local."+t),!((new Date).getTime()-c.time>s)){e.next=7;break}return b.delete("local."+t),e.abrupt("return",x.do.apply(x,[t].concat(n)));case 7:return e.abrupt("return",new Promise(function(){var e=i(a().mark((function e(t,r){var o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.func.apply(c,n);case 3:o=e.sent,e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(0),t({status:"error",json:function(){throw e.t0},text:function(){return e.t0.toString()}}),e.abrupt("return");case 10:t({status:"ok",json:function(){return JSON.parse(o)},text:function(){return o}});case 12:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,r){return e.apply(this,arguments)}}()));case 11:return e.next=13,u();case 13:p=e.sent;try{l=fRequire(p+"FaaS/local/"+t+".js")}catch(e){}return b.set("local."+t,{time:(new Date).getTime(),func:l}),e.abrupt("return",x.do.apply(x,[t].concat(n)));case 18:case 19:case"end":return e.stop()}}),e)}))),function(e){return m.apply(this,arguments)})};function O(e){return A.apply(this,arguments)}function A(){return(A=i(a().mark((function e(t){var r,n,o,s,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(console.error(t),r=t.path||[],n=0,o=r.length;n<o;n++)try{"{}"==JSON.stringify(r[n])&&(s=r[n].getAttributeNames(),i={},s.forEach((function(e){i[e]=r[n].getAttribute(e)})),r[n]=i)}catch(e){r[n]=r[n].toString()}return e.next=7,fetch("https://log-concatenate.deta.dev",{method:"POST",body:JSON.stringify({type:"client",level:"error",data:{position:t.reason?t.reason.stack:"".concat(t.filename||"null"," ").concat(t.lineno||-1,":").concat(t.colno||-1),error_number:t.error,ts:t.timestamp,reason:t.reason?t.reason.message:t.message,path:r},env:c,version:window.process&&window.process.version||window.navigator.appVersion,platform:(window.process&&window.process.platform||window.navigator.platform||"unknown").toLowerCase(),arch:window.process&&window.process.arch||(-1==window.navigator.userAgent.toLowerCase().indexOf("x64")?"ia32":"x64")})});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return S.apply(this,arguments)}function S(){return(S=i(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(new Error(t));case 2:alert("Fatal Error\n"+t),location.href="/vm/err.html?err="+t;case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(){return E=i(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=i(a().mark((function e(r,n){var o,s,i,c,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!_ip_cache){e.next=3;break}return t&&t(_ip_cache),e.abrupt("return",r(_ip_cache));case 3:return e.next=6,fetch("https://www.cloudflare.com/cdn-cgi/trace");case 6:return o=e.sent,e.next=9,o.text();case 9:for(s=(s=e.sent).split("\n"),i={},c=0,u=s.length;c<u;++c)s[c]=s[c].split("="),i[s[c][0]]=s[c][1];_ip_cache=i,t&&t(i),r(i);case 17:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)}))),E.apply(this,arguments)}window.addEventListener("error",O,!0),window.addEventListener("unhandledrejection",O,!0),window.addEventListener("rejectionhandled",O,!0),_ip_cache=null;var P,q,L,$={_groups:new Set,connect:(L=i(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var o=window.ws||window.parent.ws||window.parent.parent.ws;window.parent.parent.wsGroupRecord=window.parent.parent.wsGroupRecord||new Set;var s=window.wsGroupRecord||window.parent.wsGroupRecord||window.parent.parent.wsGroupRecord;if(o&&1===o.readyState)return o.addEventListener("message",(function(e){try{var t=JSON.parse(e.data)}catch(e){return}t.toH&&(t._to_group=~~t._to_group,s.has(t._to_group)&&sdk.publish("msg-"+t._to_group,r(r({},t),{},{toH:t._to_group+"@"})))})),console.log("Add message listener",location.href),e();console.warn(o,o&&o.readyState),window.parent.ws=new WebSocket("wss://cloud.achex.ca/concatenate@pz6w7nkeote"),(o=window.ws||window.parent.ws||window.parent.parent.ws).addEventListener("open",i(a().mark((function r(){var n;return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return setInterval((function(){try{o.send(JSON.stringify({ping:!0}))}catch(e){k(translation.translate("@{chat.ws_tunnel_destroyed}"))}}),15e3),r.t0=o,r.t1=JSON,r.t2=JSON,r.next=6,y.read("usr");case 6:r.t3=r.sent,r.t4=r.t2.parse.call(r.t2,r.t3).uid,r.t5=r.t4+"@concatenate",r.t6={auth:r.t5,passwd:"none"},r.t7=r.t1.stringify.call(r.t1,r.t6),r.t0.send.call(r.t0,r.t7),n=function r(n){"OK"===JSON.parse(n.data).auth&&(o.removeEventListener("message",r),t&&t(),e())},o.addEventListener("message",n);case 14:case"end":return r.stop()}}),r)})))),s.has(location.href)?console.warn("Too much message listener",location.href):(s.add(location.href),o.addEventListener("message",(function(e){try{var t=JSON.parse(e.data)}catch(e){return}t.toH&&(t._to_group=~~t._to_group,console.log("Receive msg",t,s.has(t._to_group)),console.log("Current page",location.href),s.has(t._to_group)&&sdk.publish("msg-"+t._to_group,r(r({},t),{},{toH:t._to_group+"@"})))})),console.log("Add message listener",location.href)),o.addEventListener("error",(function(e){console.error(e),k("Failed to establish socket tunnel.")})),o.addEventListener("close",(function(e){console.error(e),k(translation.translate("@{chat.ws_tunnel_destroyed}"))})),o.addEventListener("closed",(function(e){console.error(e),k(translation.translate("@{chat.ws_tunnel_destroyed}"))}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return L.apply(this,arguments)}),listen:(q=i(a().mark((function e(t,r){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var o=window.wsGroupRecord||window.parent.wsGroupRecord||window.parent.parent.wsGroupRecord;if(o.add(t),o.has("listen_once"))return r&&r(),void e();o.add("listen_once");var s=window.ws||window.parent.ws||window.parent.parent.ws;s||n("The tunnel is not established"),s.send(JSON.stringify({joinHub:"concatenate.message"})),s.addEventListener("message",function(){var n=i(a().mark((function n(o){var s;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("OK"===(s=JSON.parse(o.data)).joinHub&&(r&&r(),e()),"FAILED"!==s.joinHub){n.next=10;break}return console.error(s),n.t0=e,n.next=8,$.listen(t,r);case 8:n.t1=n.sent,(0,n.t0)(n.t1);case 10:case 11:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return q.apply(this,arguments)}),send:(P=i(a().mark((function e(t,n,o){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){try{var s=window.ws||window.parent.ws||window.parent.parent.ws;s||a("The tunnel is not established"),s.send(JSON.stringify(r({toH:"concatenate.message",_to_group:t},n)))}catch(e){console.error(e),k("Failed to send message to socket\n"+e.message)}o&&o(),e()})));case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return P.apply(this,arguments)})};e.exports={env:c,platform:navigator.platform.toLowerCase(),fs:y,getConfig:function(e,t){return new Promise(function(){var r=i(a().mark((function r(n,o){var s;return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,localforage.getItem("user-config");case 2:(s=r.sent)||localforage.setItem("user-config",{server:{update_server:{check:{request:{url:"https://download-concatenate.deta.dev/clientResource/latestReleaseVersion",method:"GET"},response:{success:200,failure:"other",data:"all"}},download:{request:{url:"https://download-concatenate.deta.dev/clientResource/latest",method:"GET"},response:{success:200,failure:"other",data:"all"}},timestamp:{request:{url:"https://download-concatenate.deta.dev/ping",method:"GET"},response:{success:200,failure:"other",data:"all"}}},login_server:{login:{request:{url:"https://login-concatenate.deta.dev/login",method:"POST",body:{encode:"JSON",data:{username:"${username}",passwordMD5:"${password_md5}",recaptcha:"${captcha}",ip:"${ip}"}}},response:{success:200,failure:"other",data:"all"}},register:{request:{url:"https://login-concatenate.deta.dev/register",method:"POST",body:{encode:"JSON",data:{username:"${username}",password:"${password}",passwordMD5:"${password_md5}",recaptcha:"${captcha}",ip:"${ip}"}}},response:{success:200,failure:"other",data:"all"}},change_password:{request:{url:"https://login-concatenate.deta.dev/change_password",method:"POST",body:{encode:"JSON",data:{username:"${username}",password:"${password}",passwordMD5:"${password_md5}",oldPasswordMD5:"${old_password_md5}",recaptcha:"${captcha}",ip:"${ip}"}}},response:{success:200,failure:"other",data:"all"}},get_info:{request:{url:"https://webapi-concatenate.deta.dev/usr/${uid}/info",method:"GET",headers:{Authorization:"${token}","X-API-Accept":"concatenate.webapi/1.0"}},response:{success:200,failure:"other",data:{avatar:"avatar",username:"username",uid:"uid"}}}},group_server:{list_group:{request:{url:"https://webapi-concatenate.deta.dev/usr/group/list",method:"GET",headers:{Authorization:"${token}","X-API-Accept":"concatenate.webapi/1.0"}},response:{success:200,failure:"other",data:"all"}},join_group:{request:{url:"https://webapi-concatenate.deta.dev/group/join",method:"POST",headers:{Authorization:"${token}","X-API-Accept":"concatenate.webapi/1.0"},body:{encode:"JSON",data:{groupID:"${groupID}"}}},response:{success:200,failure:"other",data:{status:"status"}}},quit_group:{request:{url:"https://webapi-concatenate.deta.dev/group/quit",method:"POST",headers:{Authorization:"${token}","X-API-Accept":"concatenate.webapi/1.0"},body:{encode:"JSON",data:{groupID:"${groupID}"}}},response:{success:200,failure:"other",data:"all"}},new_group:{request:{url:"https://webapi-concatenate.deta.dev/group",method:"POST",headers:{Authorization:"${token}","X-API-Accept":"concatenate.webapi/1.0"}},response:{success:201,failure:"other",data:{groupID:"groupID"}}},get_group_info:{request:{url:"https://webapi-concatenate.deta.dev/group/${groupID}/info",method:"GET"},response:{success:200,failure:"other",data:{name:"name",members:"members",permission:"permission",avatar:"avatar"}}},change_group_info:{request:{url:"https://webapi-concatenate.deta.dev/group/${groupID}/info",method:"PATCH",headers:{Authorization:"${token}","X-API-Accept":"concatenate.webapi/1.0"},body:{encode:"JSON",data:{key:"${key}",value:"${value}"}}},response:{success:201,failure:"other",data:"all"}},invite_member:{request:{url:"https://webapi-concatenate.deta.dev/group/${groupID}/members",method:"POST",headers:{Authorization:"${token}","X-API-Accept":"concatenate.webapi/1.0"},body:{encode:"JSON",data:{members:"${members}"}}},response:{success:201,failure:"other",data:"all"}},kick_member:{request:{url:"https://webapi-concatenate.deta.dev/group/${groupID}/members",method:"DELETE",headers:{Authorization:"${token}","X-API-Accept":"concatenate.webapi/1.0"},body:{encode:"JSON",data:{members:"${members}"}}},response:{success:200,failure:"other",data:"all"}},send_message:{request:{url:"https://webapi-concatenate.deta.dev/group/${groupID}/msg",method:"POST",headers:{Authorization:"${token}","X-API-Accept":"concatenate.webapi/1.0"},body:{encode:"JSON",data:{msg:"${msg}",anonymous:"${anonymous}",ip:"${ip}"}}},response:{success:201,failure:"other",data:{msg_id:"msg_id"}}},remove_message:{request:{url:"https://webapi-concatenate.deta.dev/group/${groupID}/msg/${msg_id}",method:"DELETE",headers:{Authorization:"${token}","X-API-Accept":"concatenate.webapi/1.0"}},response:{success:200,failure:"other",data:"all"}},get_message:{request:{url:"https://webapi-concatenate.deta.dev/group/${groupID}/msg?cursor=${cursor}",method:"GET",headers:{Authorization:"${token}","X-API-Accept":"concatenate.webapi/1.0"}},response:{success:200,failure:"other",data:{previousCursor:"previousCursor",gather:"gather"}}},get_ip_info:{request:{url:"https://ip-concatenate.deta.dev/${ip}",method:"GET",headers:{"X-API-Accept":"concatenate.webapi/ip/1.0"}},response:{success:200,failure:"other",data:{city:"city",state:"state",country:"country"}}}},socket_server:{set_up_socket:{require:"./wsproxy.js",func:"setup"},send_msg_socket:{require:"./wsproxy.js",func:"send_msg"},on_msg_socket:{require:"./wsproxy.js",func:"on_msg"},listen_group:{require:"./wsproxy.js",func:"listen_group"},unbind_group:{require:"./wsproxy.js",func:"unbind_group"}},file_storage_server:{do_upload:{protocol:"https",require:null,func:"fss.do_upload",request:{url:"https://webapi-concatenate.deta.dev/storage",method:"POST",headers:{Authorization:"${token}","X-API-Accept":"concatenate.webapi/1.0"}},response:{success:201,failure:"other",data:{fileID:"uid"}}},do_download:{protocol:"https",require:null,func:"fss.do_download",request:{url:"https://webapi-concatenate.deta.dev/storage/${fileID}",method:"GET",headers:{Authorization:"${token}","X-API-Accept":"concatenate.webapi/1.0"}},response:{success:200,failure:"other",data:"all"}},do_delete:{protocol:"https",require:null,func:"fss.do_delete",request:{url:"https://webapi-concatenate.deta.dev/storage/${fileID}",method:"DELETE",headers:{Authorization:"${token}","X-API-Accept":"concatenate.webapi/1.0"}},response:{success:200,failure:"other",data:"all"}},get_info:{protocol:"https",require:null,func:"fss.get_info",request:{url:"https://webapi-concatenate.deta.dev/storage/${fileID}?content=0",method:"GET",headers:{Authorization:"${token}","X-API-Accept":"concatenate.webapi/1.0"}},response:{success:200,failure:"other",data:{info:"data"}}},upload_avatar:{protocol:"https",require:null,func:null,request:{url:"https://webapi-concatenate.deta.dev/usr/${user_uid}/avatar",method:"PUT",headers:{Authorization:"${token}","X-API-Accept":"concatenate.webapi/1.0"},body:{encode:"JSON",data:{content:"${content}"}}},response:{success:201,failure:"other",data:{avatar_uid:"avatar_uid"}}},get_avatar:{protocol:"https",require:null,func:null,request:{url:"https://download-concatenate.deta.dev/user-avatar/${user_uid}",method:"GET"},response:{success:200,failure:"other",data:"all"}}}},user_config:{lang:"en_US"},experiments:null}),"."===e||""===e||(s=s[e]||{}),t&&t(s),n(s);case 8:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())},setConfig:function(e){localforage.setItem("user-config",e)},getModulePath:function(e,t){return new Promise((function(e,r){t&&t("./"),e("./")}))},on:f,off:h,once:function(e,t){f(e,(function r(){t.apply(void 0,arguments),h(e,r)}))},addEventListener:f,removeEventListener:h,publish:function(e){if(d.info("Emit event",e),p[e]){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];for(var o=0,a=p[e].length;o<a;++o){var s;p[e][o]instanceof Function?(s=p[e])[o].apply(s,r):d.warn("Bad listener",p[e][o])}}},inChinaSync:function(){try{if(window.XMLHttpRequest)var e=new XMLHttpRequest;else e=new ActiveXObject("Microsoft.XMLHTTP");e.open("GET","https://google.com/recaptcha/api.js",!1),e.send()}catch(e){return console.error(e),!0}return 4!=e.readyState},inChina:function(){return new Promise((function(e,t){try{if(window.XMLHttpRequest)var r=new XMLHttpRequest;else r=new ActiveXObject("Microsoft.XMLHTTP");r.open("GET","https://google.com/recaptcha/api.js",!0),r.send(),r.ontimeout=function(){e(!0)},r.onabort=function(){e(!0)},r.onerror=function(){e(!0)}}catch(t){return console.error(t),e(!0)}r.onload=function(){4==r.readyState?e(!1):e(!0)}}))},remote:_,local:x,common:l,crypto:{createHash:function(e){var t=fRequire("https://unpkg.com/js-md5");if("md5"===e)return{update:function(e){return{digest:function(r){if("hex"===r)return t(e)}}}}}},getResourcePath:u,getResourcePathSync:function(e){var t="/vm/";return e&&e(t),t},throwFatalError:k,getClientIp:function(e){return E.apply(this,arguments)},chatWs:$,quit_app:function(){location.href="/vm/entry.html"},clear_web_cache:function(){return y.unlink("web_cache")}}}},t={},function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}(299);var e,t}));